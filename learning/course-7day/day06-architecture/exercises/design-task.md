# Day 6 练习：设计一个完整功能

## 任务目标

使用架构设计方法，设计一个完整的OpenClaw功能。

---

## 难度

⭐⭐⭐ 进阶

预计时间：60-90分钟

---

## 功能选择（三选一）

| 功能 | 描述 | 难度 |
|------|------|------|
| A | 消息过滤器 | ⭐⭐ |
| B | 用户配额管理 | ⭐⭐⭐ |
| C | 插件系统 | ⭐⭐⭐⭐ |

---

## 功能A：消息过滤器

### 需求描述

允许管理员配置规则，根据内容过滤消息。

**功能需求：**
- 支持关键词过滤
- 支持正则表达式过滤
- 支持黑白名单
- 可配置动作：拦截/标记/警告
- 记录过滤日志

**非功能需求：**
- 高性能（不影响消息处理）
- 实时更新规则
- 支持1000+规则

### 你的设计

#### 1. 限界上下文

```
[画出限界上下文图]
```

#### 2. 领域模型

**实体：**
- _________________
- _________________

**值对象：**
- _________________

**领域服务：**
- _________________

**仓储：**
- _________________

#### 3. 架构设计

```
[画出分层架构图]
```

#### 4. 集成点

在哪里集成到现有系统？

```
现有流程：
接收消息 → 路由 → 处理 → 响应

集成后：
接收消息 → [_____] → 路由 → 处理 → 响应
```

#### 5. Prompt 2.0

```markdown
[编写Prompt 2.0]
```

---

## 功能B：用户配额管理

### 需求描述

限制用户的消息使用配额。

**功能需求：**
- 按天/周/月限制消息数
- 不同用户等级不同配额
- 配额用完后提示升级
- 支持配额赠送/购买

**非功能需求：**
- 精确计数
- 支持高并发
- 可水平扩展

### 你的设计

#### 1. 限界上下文

```
[画出限界上下文图]
```

#### 2. 领域模型

**实体：**
- _________________
- _________________

**值对象：**
- _________________

**领域服务：**
- _________________

#### 3. 核心算法

配额检查算法：
```
1. _________________
2. _________________
3. _________________
```

#### 4. Prompt 2.0

```markdown
[编写Prompt 2.0]
```

---

## 功能C：插件系统

### 需求描述

允许动态加载第三方插件。

**功能需求：**
- 插件注册机制
- 插件生命周期管理
- 插件间通信
- 安全沙箱
- 热加载/卸载

**非功能需求：**
- 插件隔离
- 性能影响最小
- 版本兼容性

### 你的设计

#### 1. 架构设计

```
[画出插件系统架构图]
```

#### 2. 插件接口

```typescript
interface Plugin {
  name: string;
  version: string;
  
  activate(context: PluginContext): void;
  deactivate(): void;
  
  onMessage?(message: Message): Promise<Message | null>;
  onResponse?(response: Response): Promise<Response | null>;
}

interface PluginContext {
  registerCommand(command: Command): void;
  registerHandler(handler: Handler): void;
  // ...
}
```

#### 3. 安全设计

如何确保插件安全？

- _________________
- _________________
- _________________

#### 4. Prompt 2.0

```markdown
[编写Prompt 2.0]
```

---

## 设计评审清单

### 领域模型

- [ ] 实体职责清晰
- [ ] 值对象不可变
- [ ] 聚合边界明确
- [ ] 领域服务不越界

### 架构设计

- [ ] 分层清晰
- [ ] 依赖方向正确
- [ ] 接口定义完整
- [ ] 扩展点预留

### 集成设计

- [ ] 集成点明确
- [ ] 对现有系统影响小
- [ ] 向后兼容
- [ ] 可回滚

### Prompt 2.0

- [ ] 模型描述清晰
- [ ] 架构要求明确
- [ ] 接口定义完整
- [ ] 验收标准可测量

---

## 参考模板

使用 `examples/design-template.md` 作为模板。

---

## 提交设计

将你的设计文档提交到：
- 文件名：`design-[功能名].md`
- 提交到 `designs/` 目录

---

## 下一步

完成设计后，可以尝试：
1. 用Prompt 2.0生成代码
2. 集成到OpenClaw
3. 提交PR

---

*完成此练习后，你已经具备了架构设计能力！*
